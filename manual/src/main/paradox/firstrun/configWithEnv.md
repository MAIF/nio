# Config. with ENVs

Every property in the following block can be overriden by an environment variable (an environment variable is written like `${?ENV_VARIABLE}`).

## Play settings
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|`play.http.secret.key`                                              | `APPLICATION_SECRET`                     | A token to sign cookies	                                                                                                                                                                                                           | `nioSecret`                                                     |
|`http.port`                                                         | `HTTP_PORT`                              | The port used                                                                                                                                                                                                                        | `9000`                                                          |


## Nio basic settings
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|`nio.baseUrl`                                                       | `NIO_BASE_URL`                           | Nio base url                                                                                                                                                                                                                         | `http://localhost:9000`                                         |
|`nio.logoutUrl`                                                     | `LOGOUT_URL`                             | Nio logout url, depends on security mode selected                                                                                                                                                                                    | `http://localhost:9000/api/nio/logout`                          |
|`nio.downloadFileHost`                                              | `DOWNLOAD_FILE_HOST`                     | Nio download file url                                                                                                                                                                                                                | `http://localhost:9000/_download`                               |

## Security

### Define security mode
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|`nio.filter.securityMode`                                           | `SECURITY_MODE`                          | Define the security mode : `default`, `otoroshi` or `auth0`                                                                                                                                                                          | `otoroshi`

### Security mode : otoroshi
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `nio.filter.otoroshi.issuer`                                       | `OTOROSHI_ISSUER`                        | The issuer for jwt token	                                                                                                                                                                                                           |`Otoroshi`
| `nio.filter.otoroshi.sharedKey`                                    | `CLAIM_SHAREDKEY`                        | Shared key used to encrypt jwt token	                                                                                                                                                                                               |`none`
| `nio.filter.otoroshi.headerClaim`                                  | `FILTER_CLAIM_HEADER_NAME`               | The name of the claim header	                                                                                                                                                                                                       |`Otoroshi-Claim`
| `nio.filter.otoroshi.headerRequestId`                              | `FILTER_REQUEST_ID_HEADER_NAME`          | The name of the requestId header	                                                                                                                                                                                                   |`Otoroshi-Request-Id`
| `nio.filter.otoroshi.headerGatewayState`                           | `FILTER_GATEWAY_STATE_HEADER_NAME`       | The name of the state header	                                                                                                                                                                                                       |`Otoroshi-State`
| `nio.filter.otoroshi.headerGatewayStateResp`                       | `FILTER_GATEWAY_STATE_RESP_HEADER_NAME`  | The name of the state resp header	                                                                                                                                                                                                   |`Otoroshi-State-Resp`
| `nio.filter.otoroshi.headerGatewayHeaderClientId`                  | `FILTER_GATEWAY_HEADER_CLIENT_ID`        | The name of the header for clientId	                                                                                                                                                                                               |`Otoroshi-Client-Id`
| `nio.filter.otoroshi.headerGatewayHeaderClientSecret`              | `FILTER_GATEWAY_HEADER_CLIENT_SECRET`    | The name of the header of clientSecret	                                                                                                                                                                                           |`Otoroshi-Client-Secret`
    
### Security mode : auth0
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|`nio.filter.auth0.clientId`                                         | `AUTH0_CLIENT_ID`                        | Auth0 Client Id value                                                                                                                                                                                                                |                                                                 |
|`nio.filter.auth0.clientSecret`                                     | `AUTH0_CLIENT_SECRET`                    | Auth0 Client Secret value                                                                                                                                                                                                            |                                                                 |
|`nio.filter.auth0.callbackUrl`                                      | `AUTH0_CALLBACK_URL`                     | Auth0 Callback url                                                                                                                                                                                                                   |                                                                 |
|`nio.filter.auth0.domain`                                           | `AUTH0_DOMAIN`                           | Auth0 Domain                                                                                                                                                                                                                         |                                                                 |
|`nio.filter.auth0.audience`                                         | `AUTH0_AUDIENCE`                         | Auth0 Audience                                                                                                                                                                                                                       |                                                                 |
|`nio.filter.auth0.apiKeys.headerClientId`                           | `FILTER_CLAIM_HEADER_CLIENT_ID_NAME`     | The name of the header for clientId                                                                                                                                                                                                  |                                                                 |
|`nio.filter.auth0.apiKeys.headerClientSecret`                       | `FILTER_CLAIM_HEADER_CLIENT_SECRET_NAME` | The name of the header of clientSecret                                                                                                                                                                                               |                                                                 |

### Security mode : default
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|`nio.filter.default.sharedKey`                                      | `FILTER_CLAIM_SHARED_KEY`                | Shared key used to encrypt jwt token                                                                                                                                                                                                 |`Nio`
|`nio.filter.default.cookieClaim`                                    | `FILTER_COOKIE_CLAIM`                    | Cookie name                                                                                                                                                                                                                          |`Nio`
|`nio.filter.default.issuer`                                         | `FILTER_ISSUER`                          | The issuer for jwt token                                                                                                                                                                                                             |`Nio`
|`nio.filter.default.apiKeys.headerClientId`                         | `FILTER_CLAIM_HEADER_CLIENT_ID_NAME`     | The name of the header for clientId                                                                                                                                                                                                  |`Nio-Client-Id`
|`nio.filter.default.apiKeys.headerClientSecret`                     | `FILTER_CLAIM_HEADER_CLIENT_SECRET_NAME` | The name of the header for clientSecret                                                                                                                                                                                              |`Nio-Client-Secret`
|`nio.filter.default.apiKeys.defaultUser.username`                   | `NIO_DEFAULT_USER`                       | Default nio user                                                                                                                                                                                                                     |`admin@nio.fr`
|`nio.filter.default.apiKeys.defaultUser.password`                   | `NIO_DEFAULT_PASSWORD`                   | Default nio user password                                                                                                                                                                                                            |`admin`
  

## Kafka configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `nio.kafka.servers`                                                | `KAFKA_HOST`                             | The host of the kafka server	                                                                                                                                                                                                       | `127.0.0.1:29092`                                               |
| `nio.kafka.nbPartitions`                                           | `KAFKA_NB_PARTITIONS`                    | Number of partitions                                                                                                                                                                                                                 |                                                                 |
| `nio.kafka.keyPass`                                                | `KAFKA_PASSWORD`                         | The password for ssl certificate                                                                                                                                                                                                     |                                                                 |
| `nio.kafka.keystore.location`                                      | `KAFKA_KEYSTORE_LOCATION`                | The absolute location of the keystore if ssl is used                                                                                                                                                                                 |                                                                 |
| `nio.kafka.truststore.location`                                    | `KAFKA_TRUSTORE_LOCATION`                | The absolute location of the truststore if ssl is used                                                                                                                                                                               |                                                                 |
| `nio.kafka.topic`                                                  | `KAFKA_TOPIC`                            | The kafka topic                                                                                                                                                                                                                      | `nio-consent-events`                                            |
| `nio.kafka.groupId`                                                | `KAFKA_GROUP_ID`                         | The consumer group id                                                                                                                                                                                                                | `nio`                                                           |
| `nio.kafka.eventsGroupIn`                                          | `KAFKA_EVENT_GROUP_IN`                   | The consumer group in (record management)                                                                                                                                                                                            | `10000`                                                         |
| `nio.kafka.eventsGroupDuration`                                    | `KAFKA_EVENT_GROUP_DURATION`             | The consumer group duration (record management)                                                                                                                                                                                      | `10 hours`                                                      |
| `nio.kafka.catchUpEvents.strategy`                                 | `KAFKA_CATCHUP_EVENTS_STRATEGY`          | The unsend kafka events catch up scheduler strategy. "All" to catch up all unsend events or "Last" to send just last event.                                                                                                          | `Last`                                                          |
| `nio.kafka.catchUpEvents.delay`                                    | `KAFKA_CATCHUP_EVENTS_DELAY`             | The unsend kafka events catch up scheduler delay                                                                                                                                                                                     | `1 hours`                                                       |
| `nio.kafka.catchUpEvents.interval`                                 | `KAFKA_CATCHUP_EVENTS_INTERVAL`          | The unsend kafka events catch up scheduler interval                                                                                                                                                                                  | `1 hours`                                                       |

## S3 configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `nio.recordManagementEnabled`                                      | `ENABLE_RECORD_MANAGEMENT`               | To enable the record management                                                                                                                                                                                                      | `true`                                                          |
| `nio.s3ManagementEnabled`                                          | `ENABLE_S3_MANAGEMENT`                   | To enable the S3 management                                                                                                                                                                                                          | `true`                                                          |
| `nio.s3Config.bucketName `                                         | `CELLAR_BUCKET_NAME`                     | The cellar bucket name use to the record management                                                                                                                                                                                  | `nioevents`                                                     |
| `nio.s3Config.uploadBucketName`                                    | `CELLAR_UPLOAD_BUCKET_NAME`              | The cellar bucket name use to upload and download file (extraction data request)                                                                                                                                                     | `nioupload`                                                     |
| `nio.s3Config.endpoint`                                            | `CELLAR_ADDON_HOST`                      | The host of the S3 server                                                                                                                                                                                                            | `http://localhost:8000`                                         |
| `nio.s3Config.accessKey`                                           | `CELLAR_ADDON_KEY_ID`                    | The key id of the S3 server                                                                                                                                                                                                          | `newAccessKey`                                                  |
| `nio.s3Config.secretKey`                                           | `CELLAR_ADDON_KEY_SECRET`                | The key secret of the S3 server                                                                                                                                                                                                      | `newSecretKey`                                                  |
| `nio.s3Config.expireAtInDay`                                       | `CELLAR_UPLOAD_EXPIRE_AT_IN_DAY`         | Expire at in day (extraction data request file)                                                                                                                                                                                      | `60`                                                            |
| `nio.s3Config.region`                                              | `S3_REGION`                              | The S3 Region of the S3 server                                                                                                                                                                                                       | `us-west-2`                                                     |
| `nio.s3Config.chunkSizeInMb`                                       | `S3_CHUNK_SIZE_IN_MB`                    | Chunk size to upload file on S3 server                                                                                                                                                                                               | `50`                                                            |

## Mail configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `nio.mailSendingEnable`                                            | `ENABLE_MAIL_SENDING`                    | To enable e-mail sending                                                                                                                                                                                                             | `false`                                                         |
| `nio.mailSendingProvider`                                          | `MAIL_SENDING_PROVIDER`                  | The Mail provider : `mailgun` or `mailjet`                                                                                                                                                                                           | `mailgun`                                                       |

## Mail gun configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `nio.mailGunConfig.apiKey`                                         | `MAIL_GUN_API_KEY`                       | The MailGun Api key                                                                                                                                                                                                                  |                                                                 |
| `nio.mailGunConfig.endpoint`                                       | `MAIL_GUN_ENDPOINT`                      | The MailGun Endpoint                                                                                                                                                                                                                 |                                                                 |
| `nio.mailGunConfig.from`                                           | `MAIL_GUN_SENDER`                        | The MailGun default sender                                                                                                                                                                                                           |                                                                 |

## MailJet configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `nio.mailJetConfig.apiKeyPublic`                                   | `MAIL_JET_API_KEY_PUBLIC`                | The MailJet public api key                                                                                                                                                                                                           |                                                                 |
| `nio.mailJetConfig.apiKeyPrivate`                                  | `MAIL_JET_API_KEY_PRIVATE`               | The MailJet private api key                                                                                                                                                                                                          |                                                                 |
| `nio.mailJetConfig.endpoint`                                       | `MAIL_JET_ENDPOINT`                      | The MailJet Endpoint                                                                                                                                                                                                                 |                                                                 |
| `nio.mailJetConfig.from`                                           | `MAIL_JET_SENDER`                        | The MailJet default sender                                                                                                                                                                                                           |                                                                 |

## Tenant configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `tenant.admin.header`                                              | `TENANT_ADMIN_HEADER`                    | The tenant admin header name                                                                                                                                                                                                         | `tenant-admin-secret`                                           |
| `tenant.admin.secret`                                              | `TENANT_ADMIN_SECRET`                    | The tenant admin secret                                                                                                                                                                                                              | `changeme`                                                      |

## HealthCheck configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `healthcheck.header`                                               | `HEALTH_CHECK_HEADER`                    | The health check header name                                                                                                                                                                                                         | `health-check-secret`                                           |
| `healthcheck.secret`                                               | `HEALTH_CHECK_SECRET`                    | The health check secret value                                                                                                                                                                                                        | `changeme`                                                      |

## DB configuration (both postgres and mongo) 
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `storage`                                                          | `NIO_STORAGE`                            | The database to use : `mongo` or `postgres`                                                                                                                                                                            | `mongo`                                                         |
| `store.flush`                                                      | `DB_FLUSH`                               | To initialize the mongo database                                                                                                                                                                                                     | `false`                                                         |


## MongoDB configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `mongodb.uri`                                                      | `MONGODB_ADDON_URI`                      | The mongodb addon uri                                                                                                                                                                                                                | `mongodb://localhost:27017/nio`                                 |

## Postgres configuration
| Config property                                                    | Env variable                             | Description                                                                                                                                                                                                                          | Default value                                                   |
|--------------------------------------------------------------------|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| `db.url`                                                           | `POSTGRESQL_ADDON_DATABASE_URL`          | The postgres database url                                                                                                                                                                                                            | `jdbc:postgresql://localhost:5432/nio`                          |
| `db.username`                                                      | `POSTGRESQL_ADDON_USER`                  | The postgres database username                                                                                                                                                                                                       | `nio`                                                           |
| `db.password`                                                      | `POSTGRESQL_ADDON_PASSWORD`              | The postgres database password                                                                                                                                                                                                       | `nio`                                                           |
| `db.maxPoolSize`                                                   | `POSTGRESQL_ADDON_MAX_POOL_SIZE`         | The postgres database max pool size                                                                                                                                                                                                  | `20`                                                            |
| `db.maxIdleMillis`                                                 | `POSTGRESQL_ADDON_MAX_IDLE_MILLIS`       | The max inactive time before connection is given back to the pool                                                                                                                                                                    | `1000`                                                          |
